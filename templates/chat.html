{% extends 'base.html' %}
{% block title %}Chat Ciudadano | Antioquia Dialoga{% endblock %}
{% block content %}

<div class="max-w-6xl mx-auto grid md:grid-cols-[1fr,280px] gap-4">
  <!-- Columna: Chat -->
  <section class="bg-white rounded-2xl shadow-sm p-4 flex flex-col h-[72vh]">
    <div class="flex items-center gap-2 pb-3 border-b">
      <h2 class="font-semibold">PazBot â€“ Asistente de Paz Antioquia</h2>
      <button id="newChatBtn" class="ml-auto text-xs px-3 py-1 rounded-lg bg-slate-100 hover:bg-slate-200">
        Nueva conversaciÃ³n
      </button>
      <span id="voiceStatus" class="text-xs px-2 py-1 rounded bg-emerald-100 text-emerald-700 hidden">
        Escuchandoâ€¦
      </span>
    </div>

    <!-- Ventana de chat -->
    <div id="chatWindow" class="flex-1 overflow-y-auto py-4 space-y-3">
      {% if messages %}
        {% for msg in messages %}
          <div class="max-w-[85%] {% if msg.role == 'user' %}bg-emerald-600 text-white ml-auto{% else %}bg-slate-100{% endif %} rounded-2xl px-3 py-2">
            {{ msg.content }}
          </div>
        {% endfor %}
      {% else %}
        <div class="max-w-[85%] bg-slate-100 rounded-2xl px-3 py-2">
          <p><strong>PazBot:</strong> Â¡Hola! Soy tu asistente de paz en Antioquia ðŸŒ¿. Â¿Sobre quÃ© te gustarÃ­a conversar hoy?</p>
          <p class="text-xs text-slate-500 mt-1">Consejo: puedes usar el micrÃ³fono ðŸŽ¤</p>
        </div>
      {% endif %}
    </div>

    <!-- Sugerencias rÃ¡pidas -->
    <div class="pt-2 border-t">
      <div class="flex flex-wrap gap-2 mb-3">
        {% for tema in temas %}
          <button type="button" class="tema-btn text-sm px-3 py-1.5 border rounded-xl hover:bg-emerald-50">
            {{ tema }}
          </button>
        {% endfor %}
      </div>

      <!-- Formulario -->
      <form id="chatForm" class="flex gap-2">
        <input type="hidden" id="sessionId" value="{{ session_id }}">
        <input id="chatInput" class="flex-1 border rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-400" placeholder="Escribe tu mensaje o usa el micrÃ³fonoâ€¦" />
        <button id="micBtn" type="button" class="px-3 py-2 border rounded-xl hover:bg-slate-100" title="Hablar con tu voz">ðŸŽ¤</button>
        <button type="submit" class="px-4 py-2 bg-emerald-600 text-white rounded-xl hover:bg-emerald-700">Enviar</button>
      </form>
    </div>
  </section>

  <!-- Columna: Tips -->
  <aside class="bg-white rounded-2xl shadow-sm p-4">
    <h3 class="font-semibold mb-2">Tips de uso</h3>
    <ul class="text-sm text-slate-600 list-disc pl-5 space-y-2">
      <li>Haz clic en el micrÃ³fono y habla con voz clara (es-CO).</li>
      <li>Prueba con temas: "reconciliaciÃ³n", "vÃ­ctimas", "convivencia escolar".</li>
      <li>El chatbot recuerda el contexto de tu conversaciÃ³n.</li>
      <li>Usa "Nueva conversaciÃ³n" para empezar de cero.</li>
    </ul>
  </aside>
</div>

{% endblock %}

